<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ATILLA BASOL AI MODEL</title>
  <link rel="icon" type="image/png" href="/static/ehlogo.png">
  <link rel="shortcut icon" type="image/png" href="/static/ehlogo.png">
  <link rel="apple-touch-icon" href="/static/ehlogo.png">
  <style>
    :root {
      --bg-color: #f4f4f4;
      --sidebar-bg: #fff;
      --text-color: black;
      --accent-color: #ffc107;
      --border-color: #d32f2f;
      --response-bg: #fff;
      --form-bg: white;
      --success-color: #10b981;
      --secondary-color: #64748b;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }
    
    [data-theme="dark"] {
      --bg-color: #1a1a1a;
      --sidebar-bg: #2d2d2d;
      --text-color: #e0e0e0;
      --accent-color: #ff9800;
      --border-color: #ff5722;
      --response-bg: #3d3d3d;
      --form-bg: #2d2d2d;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
    }
    
    body {
      background: var(--bg-color);
      color: var(--text-color);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      display: flex;
      margin: 0;
      padding: 0;
      height: 100vh;
      transition: all 0.3s ease;
      line-height: 1.6;
    }
    .sidebar {
      width: 420px;
      background: var(--sidebar-bg);
      color: var(--text-color);
      overflow-y: auto;
      padding: 20px 20px 20px 20px;
      padding-top: 80px;
      box-sizing: border-box;
      border-right: 1px solid var(--border-color);
      transition: all 0.3s ease, transform 0.3s ease, opacity 0.3s ease;
      box-shadow: var(--shadow);
      flex-shrink: 0;
    }
    
    .sidebar.hidden {
      transform: translateX(-100%);
      opacity: 0;
    }
    .sidebar .section-box,
    .search-box input,
    .chat-entry-row,
    .delete-all-btn {
      background: var(--accent-color);
      color: var(--text-color);
      font-weight: bold;
      padding: 12px 16px;
      margin-bottom: 12px;
      border-radius: 8px;
      text-align: center;
      width: 100%;
      height: auto;
      min-height: 44px;
      box-sizing: border-box;
      transition: all 0.3s ease;
      border: none;
      box-shadow: var(--shadow);
    }
    
    .sidebar .section-box:hover,
    .search-box input:hover,
    .delete-all-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }
    .chat-entry-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: none;
      padding: 0;
      margin-bottom: 10px;
    }
    .chat-name {
      flex: 3;
      text-align: left;
      font-size: 14px;
      background: var(--accent-color);
      color: var(--text-color);
      border-radius: 4px;
      height: 50px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding-left: 10px;
      border: 1px solid var(--text-color);
      transition: background 0.3s;
    }
    
    .chat-title {
      font-weight: 500;
      color: var(--text-color);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-bottom: 2px;
      line-height: 1.2;
    }
    
    .chat-date {
      font-size: 11px;
      color: #888;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1;
    }
    

    .chat-export {
      flex: 0 0 40px;
      background: var(--accent-color);
      border-radius: 4px;
      height: 40px;
      margin-left: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid var(--text-color);
      transition: background 0.3s;
    }
    .chat-export button {
      background: transparent;
      border: none;
      color: var(--text-color);
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
    }
    .chat-delete {
      flex: 0 0 40px;
      background: var(--accent-color);
      border-radius: 4px;
      height: 40px;
      margin-left: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid var(--text-color);
      transition: background 0.3s;
    }
    .chat-delete button {
      background: transparent;
      border: none;
      color: red;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
    }
    .search-box {
      margin-bottom: 10px;
    }
    .new-chat-btn {
      background: #4caf50 !important;
      color: white !important;
      font-weight: bold;
      border: none;
      cursor: pointer;
      width: 100%;
      height: 45px;
      border-radius: 4px;
      margin-bottom: 15px;
      font-size: 16px;
      transition: background 0.3s;
    }
    
    .new-chat-btn:hover {
      background: #45a049 !important;
      transform: scale(1.02);
    }
    
    .delete-all-btn {
      background: var(--border-color) !important;
      color: white !important;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }
    
    .home-btn {
      background: var(--accent-color) !important;
      color: var(--text-color) !important;
      font-weight: bold;
      border: none;
      cursor: pointer;
      margin-top: 10px;
    }
    .content {
      flex: 1;
      overflow-y: auto;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 15px;
      min-height: 0;
      position: relative;
      max-height: 100vh;
    }
    
    /* Scrollbar styling */
    .content::-webkit-scrollbar {
      width: 12px;
      background: var(--bg-color);
    }
    
    .content::-webkit-scrollbar-track {
      background: var(--bg-color);
      border-radius: 6px;
    }
    
    .content::-webkit-scrollbar-thumb {
      background: var(--accent-color);
      border-radius: 6px;
      border: 2px solid var(--bg-color);
    }
    
    .content::-webkit-scrollbar-thumb:hover {
      background: var(--border-color);
    }
    
    /* Force scrollbar to always show */
    .content::-webkit-scrollbar {
      width: 12px;
      background: var(--bg-color);
    }
    
    .content::-webkit-scrollbar-track {
      background: var(--bg-color);
      border-radius: 6px;
    }
    
    .content::-webkit-scrollbar-thumb {
      background: var(--accent-color);
      border-radius: 6px;
      border: 2px solid var(--bg-color);
    }
    
    .content::-webkit-scrollbar-thumb:hover {
      background: var(--border-color);
    }
    .form-container {
      border: 2px solid var(--border-color);
      background: var(--form-bg);
      color: var(--text-color);
      width: 100%;
      max-width: 500px;
      position: relative;
      margin-top: 5px;
      margin-bottom: 5px;
      transition: all 0.3s ease;
      border-radius: 8px;
      box-shadow: var(--shadow);
      overflow: visible;
    }
    .header-box {
      background: var(--accent-color);
      color: var(--text-color);
      font-size: 16px;
      font-weight: 700;
      padding: 10px;
      border-bottom: 2px solid var(--border-color);
      text-align: center;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    form {
      padding: 15px;
      text-align: left;
      box-sizing: border-box;
    }
    textarea, .checkboxes, button {
      width: 100%;
      box-sizing: border-box;
      margin: 15px 0;
      font-weight: 600;
    }
    textarea {
      height: 60px;
      resize: vertical;
      padding: 8px;
      font-size: 14px;
      display: block;
      margin: 0 auto;
      border: 2px solid var(--border-color);
      border-radius: 6px;
      background: var(--bg-color);
      color: var(--text-color);
      transition: all 0.3s ease;
      font-family: inherit;
    }
    
    textarea:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.1);
    }
    .checkboxes {
      position: relative;
    }
    .checkboxes label {
      display: block;
      background: var(--accent-color);
      margin: 4px 0;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      color: var(--text-color);
      font-size: 13px;
    }
    
    .checkboxes label:hover {
      background: var(--border-color);
      color: white;
      transform: translateX(5px);
    }
    
    .checkboxes input:checked + label {
      background: var(--border-color);
      color: white;
      border-color: var(--accent-color);
    }
    .checkboxes input {
      margin-right: 5px;
    }
    
    /* Submit Button Styling */
    #submitBtn {
      background: var(--success-color);
      color: white;
      font-weight: 700;
      padding: 12px 24px;
      border: 3px solid red;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 8px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      box-shadow: var(--shadow);
      position: relative;
      z-index: 10;
      min-height: 50px;
    }
    
    #submitBtn:hover {
      background: #0d9488;
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }
    
    #submitBtn:disabled {
      background: var(--secondary-color);
      cursor: not-allowed;
      transform: none;
    }
    
    /* Dosya YÃ¼kleme Stilleri */
    .file-upload-section {
      margin: 15px 0;
      padding: 15px;
      border: 2px dashed var(--accent-color);
      border-radius: 8px;
      background: var(--bg-color);
      transition: border-color 0.3s;
    }
    
    .file-upload-section:hover {
      border-color: var(--border-color);
    }
    
    .file-upload-label {
      display: block;
      font-weight: bold;
      margin-bottom: 8px;
      color: var(--text-color);
      cursor: pointer;
    }
    
    #attachments {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--text-color);
      border-radius: 4px;
      background: var(--form-bg);
      color: var(--text-color);
      cursor: pointer;
    }
    
    .file-preview {
      margin-top: 10px;
    }
    
    .file-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px;
      margin: 5px 0;
      background: var(--response-bg);
      border-radius: 4px;
      border: 1px solid var(--text-color);
    }
    
    .file-name {
      font-size: 14px;
      color: var(--text-color);
      flex-grow: 1;
    }
    
    .file-size {
      font-size: 12px;
      color: #666;
      margin-left: 10px;
    }
    
    .remove-file {
      background: var(--border-color);
      color: white;
      border: none;
      border-radius: 3px;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 12px;
      margin-left: 10px;
    }
    .spinner {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 113px;
      height: 113px;
      display: none;
      animation: spin 1s linear infinite;
      border-radius: 50%;
      object-fit: cover;
      background: white;
      z-index: 10;
    }
    @keyframes spin {
      from { transform: translate(-50%, -50%) rotate(0deg); }
      to { transform: translate(-50%, -50%) rotate(360deg); }
    }
    button {
      background: #d32f2f;
      color: #fff;
      padding: 10px;
      border: none;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
      font-weight: bold;
    }
    .response, .synthesis {
      background: var(--response-bg);
      color: var(--text-color);
      border: 1px solid var(--text-color);
      margin-top: 10px;
      padding: 10px;
      text-align: left;
      font-weight: bold;
      width: 600px;
      display: none;
      transition: background 0.3s, border 0.3s;
      word-wrap: break-word;
      overflow-wrap: break-word;
      white-space: pre-wrap;
    }
    .model {
      color: var(--border-color);
      font-weight: bold;
    }
    .elapsed {
      color: var(--border-color);
      font-weight: bold;
      font-size: 12px;
      float: right;
    }
    .synthesis {
      background: #e3f2fd;
      border: 2px solid #2196f3;
      padding: 10px;
      margin-top: 10px;
      margin-bottom: 20px;
      font-weight: bold;
      color: #0d47a1;
    }
    
    /* Soru kÄ±smÄ± iÃ§in Ã¶zel stil */
    .question-section {
      background: var(--form-bg);
      border: 2px solid var(--accent-color);
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      box-shadow: var(--shadow);
      color: var(--text-color);
      word-wrap: break-word;
      overflow-wrap: break-word;
      white-space: pre-wrap;
      width: 100%;
      max-width: 500px;
      box-sizing: border-box;
      position: relative;
      margin-top: 5px;
      margin-bottom: 5px;
      transition: all 0.3s ease;
    }
    
    .question-section h2 {
      margin: 0 0 10px 0;
      color: var(--accent-color);
      font-size: 16px;
      font-weight: 700;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .question-section .question-text {
      font-size: 14px;
      line-height: 1.5;
      color: var(--text-color);
      background: var(--bg-color);
      padding: 10px;
      border-radius: 6px;
      border: 1px solid var(--border-color);
      max-height: 200px;
      overflow-y: auto;
      word-wrap: break-word;
      overflow-wrap: break-word;
      white-space: pre-wrap;
      font-weight: 600;
    }
    
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--accent-color);
      color: var(--text-color);
      border: 2px solid var(--border-color);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: all 0.3s;
    }
    
    .menu-toggle {
      position: fixed;
      top: 20px;
      left: 20px;
      background: var(--accent-color);
      color: var(--text-color);
      border: 2px solid var(--border-color);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: all 0.3s;
    }
    
    .menu-toggle:hover {
      transform: scale(1.1);
    }
    
    .theme-toggle:hover {
      transform: scale(1.1);
    }
    
    /* Eklenen Dosyalar Stilleri */
    .attached-files-section {
      margin: 20px 0;
      padding: 15px;
      background: var(--response-bg);
      border: 2px solid var(--accent-color);
      border-radius: 8px;
    }
    
    .attached-files-section h3 {
      margin: 0 0 10px 0;
      color: var(--text-color);
      font-size: 16px;
    }
    
    .attached-files-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .attached-file-item {
      display: flex;
      align-items: center;
      padding: 8px 12px;
      background: var(--form-bg);
      border: 1px solid var(--text-color);
      border-radius: 6px;
      font-size: 14px;
    }
    
    .file-icon {
      margin-right: 8px;
      font-size: 16px;
    }
    
    /* Link stilleri - uzun URL'lerin dÃ¼zgÃ¼n sarÄ±lmasÄ± iÃ§in */
    a {
      word-wrap: break-word;
      overflow-wrap: break-word;
      max-width: 100%;
      display: inline-block;
    }
    
    /* Response iÃ§indeki linkler iÃ§in Ã¶zel stil */
    .response a, .synthesis a {
      word-break: break-all;
      hyphens: auto;
      max-width: 100%;
      box-sizing: border-box;
    }
    
    /* Available Models Stilleri */
    .available-models {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      padding: 10px;
      background: var(--form-bg);
    }
    
    .available-model-item {
      display: flex;
      align-items: center;
      margin: 8px 0;
      padding: 8px;
      border-radius: 4px;
      transition: background 0.2s;
      cursor: pointer;
    }
    
    .available-model-item:hover {
      background: var(--accent-color);
      color: var(--text-color);
    }
    
    .available-model-item input[type="checkbox"] {
      margin-right: 10px;
    }
    
    .model-name {
      font-weight: bold;
      margin-right: 8px;
      color: var(--accent-color);
      display: inline-block;
      min-width: 140px;
      text-align: left;
      font-size: 12px;
    }
    
    .model-description {
      font-size: 11px;
      color: var(--secondary-color);
      display: inline-block;
      word-wrap: break-word;
      max-width: 250px;
      line-height: 1.3;
      margin-left: 5px;
    }
    
    .available-model-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      padding: 5px;
      border-radius: 4px;
      transition: background-color 0.2s ease;
    }
    
    .available-model-item:hover {
      background-color: var(--form-bg);
    }
    
    /* Responsive TasarÄ±m */
    @media (max-width: 1200px) {
      .sidebar {
        width: 280px;
        min-width: 280px;
      }
      
      .content {
        padding: 10px;
      }
      
      .form-container, .question-section {
        max-width: 450px;
      }
    }
    
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        min-width: 100%;
        height: auto;
        max-height: 300px;
        order: 2;
        padding-top: 60px;
      }
      
      .content {
        order: 1;
        padding: 10px;
        max-height: none;
        overflow: visible;
      }
      
      .form-container, .question-section {
        max-width: 100%;
        width: 100%;
        margin: 10px 0;
      }
      
      .header-box {
        font-size: 14px;
        padding: 8px;
      }
      
      .checkboxes {
        max-height: 150px;
        overflow-y: auto;
      }
      
          .available-models {
      max-height: 120px;
      width: 100%;
      overflow-x: hidden;
    }
      
      .theme-toggle {
        bottom: 10px;
        right: 10px;
        width: 40px;
        height: 40px;
        font-size: 16px;
      }
      
      .menu-toggle {
        top: 10px;
        left: 10px;
        width: 40px;
        height: 40px;
        font-size: 16px;
      }
      
      .chat-entry-row {
        padding: 8px;
        margin: 5px 0;
      }
      
      .home-btn {
        margin-top: 8px;
        padding: 10px;
        font-size: 14px;
      }
      
      .chat-title {
        font-size: 14px;
      }
      
      .chat-date {
        font-size: 11px;
      }
      
      .response, .synthesis {
        padding: 10px;
        margin: 10px 0;
      }
      
      .model {
        font-size: 12px;
      }
      
      .elapsed {
        font-size: 10px;
      }
    }
    
    @media (max-width: 480px) {
      .sidebar {
        max-height: 250px;
        padding-top: 50px;
      }
      
      .content {
        padding: 5px;
      }
      
      .form-container, .question-section {
        margin: 5px 0;
        padding: 10px;
      }
      
      .header-box {
        font-size: 12px;
        padding: 6px;
      }
      
      .checkboxes {
        max-height: 120px;
      }
      
      .available-models {
        max-height: 100px;
      }
      
      .chat-entry-row {
        padding: 6px;
        margin: 3px 0;
      }
      
      .home-btn {
        margin-top: 5px;
        padding: 8px;
        font-size: 12px;
      }
      
      .chat-title {
        font-size: 13px;
      }
      
      .chat-date {
        font-size: 10px;
      }
      
      .response, .synthesis {
        padding: 8px;
        margin: 8px 0;
      }
      
      .model {
        font-size: 11px;
      }
      
      .elapsed {
        font-size: 9px;
      }
      
      .theme-toggle {
        bottom: 5px;
        right: 5px;
        width: 35px;
        height: 35px;
        font-size: 14px;
      }
    }
    
    /* Landscape orientation for mobile */
    @media (max-width: 768px) and (orientation: landscape) {
      .sidebar {
        max-height: 200px;
      }
      
      .content {
        padding: 5px;
      }
    }
    
    /* High DPI displays */
    @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
      .theme-toggle {
        border-width: 1px;
      }
      
      .form-container, .question-section {
        border-width: 1px;
      }
    }
  </style>
</head>
<body>
<button class="theme-toggle" onclick="toggleTheme()" title="Dark/Light Mode">ð</button>
<button class="menu-toggle" onclick="toggleSidebar()" title="Toggle Menu">â°</button>
<div class="sidebar" id="sidebar">
  <button class="new-chat-btn" onclick="window.location.href='/main'">â New Chat</button>
  <div class="section-box">ð Saved Chats</div>
  <div class="search-box">
    <input type="text" id="search" placeholder="Search...">
  </div>
  {% for chat in saved_chats %}
    <div class="chat-entry-row" data-keywords="{{ chat.question|lower }}">
      <div class="chat-name">
        <a href="/chat/{{ chat.filename }}" style="color: inherit; text-decoration: none;">
          <div class="chat-title">{{ chat.title or chat.question[:30] + "..." }}</div>
          <div class="chat-date">{{ chat.timestamp }}</div>
        </a>
      </div>
      <div class="chat-export">
        <button onclick="exportChat('{{ chat.filename }}', event)" title="Export as Markdown">ð</button>
      </div>
      <div class="chat-delete">
        <button onclick="deleteChat('{{ chat.filename }}', event)" title="Delete Chat">ðï¸</button>
      </div>
    </div>
  {% endfor %}
  <button class="delete-all-btn" onclick="deleteAllChats()">Delete All</button>
  <button class="home-btn" onclick="window.location.href='/'">ð  Home</button>
</div>
<div class="content" id="mainContent">
  {% if chat %}
    <div class="question-section">
      <h2>Question:</h2>
      <div class="question-text">{{ chat.question }}</div>
    </div>
    {% if chat.attached_files %}
    <div class="attached-files-section">
      <h3>ð Attached Files:</h3>
      <div class="attached-files-list">
        {% for file in chat.attached_files %}
        <div class="attached-file-item">
          <span class="file-icon">ð</span>
          <span class="file-name">{{ file.name }}</span>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    {% for r in chat.responses %}
    <div class="response">
      <div class="model">{{ r.model }} - {{ model_descriptions[r.model] }}<span class="elapsed">{{ r.elapsed | round(2) }} sec</span></div>
      <div class="text">{{ r.text }}</div>
    </div>
    {% endfor %}
    <div class="synthesis">
      <strong>Combined Answer:</strong>
      <span class="text">{{ chat.synthesis }}</span>
    </div>
  {% endif %}
  <div class="form-container" id="formContainer">
    <img src="/static/ehlogo.png" class="spinner" id="spinner">
    <div class="header-box">ATILLA BASOL AI MODEL</div>
    <form method="post" action="/" id="questionForm" enctype="multipart/form-data">
      {% if conversation_id %}
      <input type="hidden" name="conversation_id" value="{{ conversation_id }}">
      {% elif chat and chat.conversation_id %}
      <input type="hidden" name="conversation_id" value="{{ chat.conversation_id }}">
      {% endif %}
      <textarea id="question" name="question" placeholder="Write your question here..." required></textarea>
      
      <!-- File Upload Area -->
      <div class="file-upload-section">
        <label for="attachments" class="file-upload-label">
          ð Attach Files
        </label>
        <input type="file" id="attachments" name="attachments" accept=".txt,.pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.mp4,.avi,.mov,.mkv,.webm,.flv">
        <small style="color: #666; font-size: 12px;">Supported: PDF, DOCX, TXT, JPG, PNG, MP4, AVI, MOV, MKV</small>
        <div id="file-preview" class="file-preview"></div>
      </div>
      <div class="checkboxes">
        <h4 style="margin: 0 0 10px 0; color: var(--accent-color);">ð¯ All Online Models</h4>
        <label><input type="checkbox" name="models" value="__all__" checked> ALL MODELS</label>
        {% for m in models %}
        <label><input type="checkbox" name="models" value="{{m}}">{{ m.upper() }} ({{ model_descriptions[m] }})</label>
        {% endfor %}
        
        <hr style="margin: 15px 0; border: 1px solid var(--border-color);">
        
        <h4 style="margin: 0 0 10px 0; color: var(--accent-color);">ð Free Open Source Models</h4>
        <div class="available-models">
          {% for model_id, description in available_models.items() %}
            {% if model_id not in models %}
            <label class="available-model-item">
              <input type="checkbox" name="available_models" value="{{model_id}}" onchange="toggleModel(this, '{{model_id}}')">
              <span class="model-name">{{ model_id.split('/')[-1].replace('-', ' ').upper() }}</span>
              <span class="model-description">{{ description }}</span>
            </label>
            {% endif %}
          {% endfor %}
        </div>
      </div>
      <button type="submit" id="submitBtn">
        ð SEND
      </button>
    </form>
  </div>
</div>
<script>
  // Theme toggle functionality
  function toggleTheme() {
    const body = document.body;
    const button = document.querySelector('.theme-toggle');
    const currentTheme = body.getAttribute('data-theme');
    
    if (currentTheme === 'dark') {
      body.removeAttribute('data-theme');
      button.textContent = 'ð';
      localStorage.setItem('theme', 'light');
    } else {
      body.setAttribute('data-theme', 'dark');
      button.textContent = 'âï¸';
      localStorage.setItem('theme', 'dark');
    }
  }
  
  // Sidebar toggle functionality
  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const menuToggle = document.querySelector('.menu-toggle');
    
    if (sidebar.classList.contains('hidden')) {
      sidebar.classList.remove('hidden');
      menuToggle.textContent = 'â°';
      localStorage.setItem('sidebar', 'open');
    } else {
      sidebar.classList.add('hidden');
      menuToggle.textContent = 'â°';
      localStorage.setItem('sidebar', 'closed');
    }
  }
  
  // Load saved theme and sidebar state on page load
  window.addEventListener('DOMContentLoaded', function() {
    const savedTheme = localStorage.getItem('theme');
    const savedSidebarState = localStorage.getItem('sidebar');
    const themeButton = document.querySelector('.theme-toggle');
    const sidebar = document.getElementById('sidebar');
    
    if (savedTheme === 'dark') {
      document.body.setAttribute('data-theme', 'dark');
      themeButton.textContent = 'âï¸';
    } else {
      themeButton.textContent = 'ð';
    }
    
    if (savedSidebarState === 'closed') {
      sidebar.classList.add('hidden');
    }
  });

  function exportChat(filename, event) {
    event.preventDefault();
    window.open(`/export/${filename}`, '_blank');
  }
  
  function deleteChat(filename, event) {
    event.preventDefault();
    fetch(`/delete/${filename}`, {
      method: 'DELETE'
    })
    .then(response => response.json())
    .then(data => {
      if (data.status === 'deleted') {
        // Only remove chat from sidebar, don't reload page
        const chatElement = event.target.closest('.chat-entry-row');
        if (chatElement) {
          chatElement.remove();
        }
        // If current chat is deleted, redirect to main page
        if (window.location.pathname.includes('/chat/') && window.location.pathname.includes(filename)) {
          window.location.href = '/main';
        }
      } else {
        alert('Delete error: ' + (data.message || 'Unknown error'));
      }
    })
    .catch(error => {
      console.error('Delete error:', error);
      alert('An error occurred during deletion');
    });
  }
  
  function deleteAllChats() {
    fetch(`/delete_all`, {
      method: 'DELETE'
    })
    .then(response => response.json())
    .then(data => {
      if (data.status === 'all_deleted') {
        // Remove all chats from sidebar
        document.querySelectorAll('.chat-entry-row').forEach(el => el.remove());
        // Redirect to main page
        window.location.href = '/main';
      } else {
        alert('Delete error: ' + (data.message || 'Unknown error'));
      }
    })
    .catch(error => {
      console.error('Delete error:', error);
      alert('An error occurred during deletion');
    });
  }
  
  // Model add/remove function
  function toggleModel(checkbox, modelId) {
    const modelsContainer = document.querySelector('.checkboxes');
    const modelDescriptions = JSON.parse('{{ available_models | tojson | safe }}');
    
    if (checkbox.checked) {
      // Add model to active list
      const newLabel = document.createElement('label');
      newLabel.innerHTML = '<input type="checkbox" name="models" value="' + modelId + '" checked onchange="removeModel(this, \'' + modelId + '\')">' + 
                          modelId.toUpperCase() + ' (' + modelDescriptions[modelId] + ')';
      
      // Add to active models section
      const activeModelsSection = modelsContainer.querySelector('h4').nextElementSibling.nextElementSibling;
      activeModelsSection.parentNode.insertBefore(newLabel, activeModelsSection.nextSibling);
      
      // Remove from available models
      checkbox.closest('.available-model-item').remove();
      
      // If "__all__" is selected, prevent individual model selection
      const allModelsCheckbox = document.querySelector('input[name="models"][value="__all__"]');
      if (allModelsCheckbox && allModelsCheckbox.checked) {
        // Prevent individual model selection in active models list
        const activeModelCheckboxes = modelsContainer.querySelectorAll('input[name="models"]:not([value="__all__"])');
        activeModelCheckboxes.forEach(cb => {
          if (cb.value !== modelId) { // Except newly added model
            cb.checked = false;
          }
        });
      }
    }
  }
  
  // Model removal function
  function removeModel(checkbox, modelId) {
    if (!checkbox.checked) {
      // Remove model from active list
      checkbox.closest('label').remove();
      
      // Add back to available models
      const availableModelsSection = document.querySelector('.available-models');
      const newItem = document.createElement('div');
      newItem.className = 'available-model-item';
      newItem.innerHTML = '<label><input type="checkbox" onchange="toggleModel(this, \'' + modelId + '\')">' + 
                         modelId.toUpperCase() + ' (' + JSON.parse('{{ available_models | tojson | safe }}')[modelId] + ')</label>';
      availableModelsSection.appendChild(newItem);
    }
  }
  document.getElementById('search').addEventListener('input', function() {
    const term = this.value.toLowerCase();
    document.querySelectorAll('.chat-entry-row').forEach(el => {
      el.style.display = el.dataset.keywords.includes(term) ? 'flex' : 'none';
    });
  });
  // Dosya yÃ¼kleme iÅlevselliÄi (tek dosya)
  document.getElementById('attachments').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const preview = document.getElementById('file-preview');
    preview.innerHTML = '';
    
    if (file) {
      const fileItem = document.createElement('div');
      fileItem.className = 'file-item';
      
      const fileName = document.createElement('span');
      fileName.className = 'file-name';
      fileName.textContent = file.name;
      
      const fileSize = document.createElement('span');
      fileSize.className = 'file-size';
      fileSize.textContent = formatFileSize(file.size);
      
      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-file';
      removeBtn.textContent = 'â';
      removeBtn.type = 'button';
      removeBtn.onclick = function() {
        document.getElementById('attachments').value = '';
        preview.innerHTML = '';
      };
      
      fileItem.appendChild(fileName);
      fileItem.appendChild(fileSize);
      fileItem.appendChild(removeBtn);
      preview.appendChild(fileItem);
    }
  });
  
  function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  }
  
  // removeFile function is not needed for single file upload
  
  document.getElementById('questionForm').addEventListener('submit', function(e) {
    // Collect all active models before form submission
    const allModelCheckboxes = document.querySelectorAll('input[name="models"]:checked');
    const selectedModels = Array.from(allModelCheckboxes).map(cb => cb.value);
    
    console.log('Selected models:', selectedModels);
    
    // If "__all__" is selected, include dynamically added models
    if (selectedModels.includes('__all__')) {
      console.log('All models selected - including dynamic models');
      
      // Get default models (MODELS list)
      const defaultModels = JSON.parse('{{ models | tojson | safe }}');
      console.log('Default models:', defaultModels);
      
      // Find dynamically added models
      const dynamicModels = document.querySelectorAll('input[name="models"]:checked');
      const dynamicModelValues = Array.from(dynamicModels).map(cb => cb.value);
      
      // Filter dynamic models excluding "__all__"
      const extraModels = dynamicModelValues.filter(model => model !== '__all__');
      console.log('Extra added models:', extraModels);
      
      // Combine default + extra models
      const finalModels = [...defaultModels, ...extraModels];
      console.log('Final models (default + extra):', finalModels);
      
      // Add hidden input to form
      let hiddenInput = document.querySelector('input[name="final_models"]');
      if (!hiddenInput) {
        hiddenInput = document.createElement('input');
        hiddenInput.type = 'hidden';
        hiddenInput.name = 'final_models';
        document.getElementById('questionForm').appendChild(hiddenInput);
      }
      hiddenInput.value = JSON.stringify(finalModels);
    } else {
      console.log('Custom models selected:', selectedModels);
      
      // Remove hidden input from form
      const hiddenInput = document.querySelector('input[name="final_models"]');
      if (hiddenInput) {
        hiddenInput.remove();
      }
    }
    
    const fileInput = document.getElementById('attachments');
    console.log('Form submit - file exists?', fileInput.files.length > 0);
    if (fileInput.files.length > 0) {
      console.log('File name:', fileInput.files[0].name);
      console.log('File size:', fileInput.files[0].size);
    }
    
    document.getElementById('spinner').style.display = 'block';
    
    // Switch submit button to stop mode
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.innerHTML = 'â¹ï¸ STOP';
    submitBtn.onclick = function(e) {
      e.preventDefault();
      stopRequest();
    };
    submitBtn.disabled = false;
  });
  
  // Stop function
  function stopRequest() {
    const submitBtn = document.getElementById('submitBtn');
    const spinner = document.getElementById('spinner');
    
    // Return button to normal state
    submitBtn.innerHTML = '<img src="/static/start-icon.png" alt="Start" style="width: 20px; height: 20px; margin-right: 8px;"> SEND';
    submitBtn.onclick = null; // Restore normal submit behavior
    submitBtn.disabled = false;
    
    // Hide spinner
    if (spinner) {
      spinner.style.display = 'none';
    }
    
    // Real stop operation can be implemented here
    console.log('Request stopped');
  }
  
  // Event listener for "All Models" checkbox
  document.addEventListener('DOMContentLoaded', function() {
    const allModelsCheckbox = document.querySelector('input[name="models"][value="__all__"]');
    if (allModelsCheckbox) {
      allModelsCheckbox.addEventListener('change', function() {
        if (this.checked) {
          // When "All Models" is selected, prevent individual model selection
          const activeModelCheckboxes = document.querySelectorAll('input[name="models"]:not([value="__all__"])');
          activeModelCheckboxes.forEach(cb => {
            cb.checked = false;
          });
        }
      });
      
      // Check on page load
      if (allModelsCheckbox.checked) {
        const activeModelCheckboxes = document.querySelectorAll('input[name="models"]:not([value="__all__"])');
        activeModelCheckboxes.forEach(cb => {
          cb.checked = false;
        });
      }
    }
  });
  
  // Event listener for all checkboxes
  document.addEventListener('change', function(e) {
    if (e.target.name === 'models' && e.target.value !== '__all__') {
      const allModelsCheckbox = document.querySelector('input[name="models"][value="__all__"]');
      if (allModelsCheckbox && allModelsCheckbox.checked) {
        // Prevent individual model selection when "All Models" is active
        e.target.checked = false;
        // Silently prevent, no alert
      }
    }
  });
  
  window.onload = function () {
    // Stay at top when page loads
    window.scrollTo(0, 0);
    
    const contentDiv = document.getElementById("mainContent");
    
    // Typing effect only on main page (after new question)
    const isMainPage = !window.location.pathname.includes('/chat/');
    const responses = document.querySelectorAll('.response');
    const synthesis = document.querySelector('.synthesis');
    
    // Show directly in old chats, typing effect in new questions
    if (!isMainPage) {
      // Old chat - show directly
      responses.forEach(resp => resp.style.display = 'block');
      if (synthesis) synthesis.style.display = 'block';
      return;
    }
    

    
    let i = 0;
    function typeText(element, text, callback) {
      element.innerHTML = '';
      let idx = 0;
      function typer() {
        if (idx < text.length) {
          element.innerHTML += text.charAt(idx);
          idx++;
          // Remove auto-scroll during typing
          // contentDiv.scrollTo({ top: contentDiv.scrollHeight, behavior: 'smooth' });
          setTimeout(typer, 15);
        } else {
          if (callback) callback();
        }
      }
      typer();
    }
    function showNext() {
      if (i < responses.length) {
        const resp = responses[i];
        resp.style.display = 'block';
        const textEl = resp.querySelector('.text');
        const textContent = textEl.textContent;
        typeText(textEl, textContent, () => {
          i++;
          showNext();
        });
      } else {
        if (synthesis) {
          synthesis.style.display = 'block';
          const textEl = synthesis.querySelector('.text');
          const textContent = textEl.textContent;
          typeText(textEl, textContent, () => {
            // Scroll only once when synthesis is complete
            contentDiv.scrollTo({ top: contentDiv.scrollHeight, behavior: 'smooth' });
          });
        }
      }
    }
    if (responses.length > 0) {
      showNext();
    }
  }
</script>
</body>
</html>
